<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="SemidÃ¡n Robaina" /><link rel="canonical" href="https://robaina.github.io/Pynteny/references/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>References - Pynteny</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "References";
        var mkdocs_page_input_path = "references.md";
        var mkdocs_page_url = "/Pynteny/references/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Pynteny
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Subcommands</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../subcommands/search/">Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../subcommands/build/">Build</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../subcommands/parse/">Parse</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../subcommands/download/">Download</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../subcommands/app/">App</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/example_cli/">Example CLI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/example_api/">Example API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/example_sus/">Sus operon</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">References</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="api/">API references</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Pynteny</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>References</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Robaina/Pynteny/edit/master/docs/references.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">


<a id="pynteny.filter"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to filter HMM hits by synteny structure</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pynteny.filter.SyntenyHMMfilter" class="doc doc-heading">
        <code>SyntenyHMMfilter</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Tools to search for synteny structures among sets of hmm models</p>


        <details class="quote">
          <summary>Source code in <code>pynteny/filter.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SyntenyHMMfilter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tools to search for synteny structures among sets of hmm models&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hmm_hits</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">synteny_structure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for contigs that satisfy the given gene synteny structure.</span>

<span class="sd">        Args:</span>
<span class="sd">            hmm_hits (dict): a dict of pandas DataFrames, as output by</span>
<span class="sd">                parseHMMsearchOutput with keys corresponding to hmm names</span>
<span class="sd">            synteny_structure (str): a str describing the desired synteny structure,</span>
<span class="sd">                structured as follows:</span>

<span class="sd">                &#39;&gt;hmm_a N_ab hmm_b bc &lt;hmm_c&#39;</span>

<span class="sd">                where N_ab corresponds to the maximum number of genes separating</span>
<span class="sd">                gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds</span>
<span class="sd">                to the name of the hmm as provided in the keys of hmm_hits.</span>
<span class="sd">                More than two hmms can be concatenated. Strand location may be</span>
<span class="sd">                specificed by using &#39;&gt;&#39; for sense and &#39;&lt;&#39; for antisense.</span>
<span class="sd">            unordered (bool, optional): whether the HMMs should be arranged in the</span>
<span class="sd">                exact same order displayed in the synteny_structure or in</span>
<span class="sd">                any order. If ordered, the filters would filter collinear rather</span>
<span class="sd">                than syntenic structures. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span> <span class="o">=</span> <span class="n">unordered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hmm_hits</span> <span class="o">=</span> <span class="n">hmm_hits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hmms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hmm_hits</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span> <span class="o">=</span> <span class="n">synteny_structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contains_hmm_groups</span> <span class="o">=</span> <span class="n">syntenyparser</span><span class="o">.</span><span class="n">contains_HMM_groups</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span> <span class="o">=</span> <span class="n">syntenyparser</span><span class="o">.</span><span class="n">parse_synteny_structure</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;strands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;strands&quot;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Disregarding strand location as unordered structured selected&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hmm_order_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;hmm_groups&quot;</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;hmm_groups&quot;</span><span class="p">])),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hmm_order_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span> <span class="o">=</span> <span class="n">unordered</span>

    <span class="k">def</span> <span class="nf">_assign_code_to_HMM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hmm_group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">hmm_group_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hmm_group_name</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">code</span>
            <span class="k">for</span> <span class="n">hmm_group</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hmm_order_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">hmm_group_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">hmm_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)))</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;HMM: </span><span class="si">{</span><span class="n">hmm_group_name</span><span class="si">}</span><span class="s2"> found in more than one hmm group in synteny structure&quot;</span>
            <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No code found for HMM: </span><span class="si">{</span><span class="n">hmm_group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_add_meta_codes_to_HMM_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_hit_labels</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Dataframe</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Dataframe</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add numeric codes for each hmm and strand, compute distance between genes&quot;&quot;&quot;</span>
        <span class="n">all_hit_labels</span><span class="p">[</span><span class="s2">&quot;gene_pos_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">gene_pos</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
        <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;gene_pos_diff&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># required for rolling (skips first nan)</span>
        <span class="n">all_hit_labels</span><span class="p">[</span><span class="s2">&quot;hmm_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_assign_code_to_HMM</span><span class="p">)</span>
        <span class="n">all_hit_labels</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">strand</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">strand</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="s2">&quot;neg&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="s2">&quot;pos&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">all_hit_labels</span>

    <span class="k">def</span> <span class="nf">_merge_hits_by_HMM_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hits</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge hit sequences within an HMM group representing</span>
<span class="sd">        the same gene symbol. Drop duplicated hits within</span>
<span class="sd">        each HMM group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">hits</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;full_label&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span>
        <span class="k">for</span> <span class="n">group_idxs</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">hmm_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">hits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">group_idxs</span><span class="p">,</span> <span class="s2">&quot;hmm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">candidate_hmm_group</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">hmm_group_str</span>
                <span class="k">for</span> <span class="n">hmm_group_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;hmm_groups&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hmm_names</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">hmm_group_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)))</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">candidate_hmm_group</span><span class="p">:</span>
                <span class="n">hmm_group</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hmm_names</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hmm_group</span> <span class="o">=</span> <span class="s2">&quot;discard&quot;</span>
            <span class="n">hits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">group_idxs</span><span class="p">,</span> <span class="s2">&quot;hmm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmm_group</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="n">hits</span><span class="p">[</span><span class="n">hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">!=</span> <span class="s2">&quot;discard&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">=</span> <span class="n">hits</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">hits</span>

    <span class="k">def</span> <span class="nf">get_all_HMM_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Group and preprocess all hit labels into a single dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: HMMER3 hit labels matching provided HMMs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hit_labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">hmm</span><span class="p">,</span> <span class="n">hits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hmm_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">hits</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No records found in database matching HMM: </span><span class="si">{</span><span class="n">hmm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">hit_labels</span><span class="p">[</span><span class="n">hmm</span><span class="p">]</span> <span class="o">=</span> <span class="n">labelparser</span><span class="o">.</span><span class="n">parse_from_list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="n">hit_labels</span><span class="p">[</span><span class="n">hmm</span><span class="p">][</span><span class="s2">&quot;hmm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmm</span>
        <span class="c1"># Create single dataframe with new column corresponding to HMM and all hits</span>
        <span class="c1"># Remove contigs with less hits than the number of hmms in synteny structure (drop if enabling partial searching)</span>
        <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">hit_labels</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;contig&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;contig&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_pos&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains_hmm_groups</span><span class="p">:</span>
            <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_hits_by_HMM_group</span><span class="p">(</span><span class="n">all_hit_labels</span><span class="p">)</span>
        <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_meta_codes_to_HMM_hits</span><span class="p">(</span><span class="n">all_hit_labels</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_hits_by_synteny_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for contigs that satisfy the given gene synteny structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: HMMER3 hits separated by contig.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_matched_hits</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">SyntenyPatternFilters</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span><span class="p">,</span> <span class="n">unordered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span>
        <span class="p">)</span>
        <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_HMM_hits</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;At least two different HMMs produced identical sequence hits&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;All input profile HMMs rendered identical sequence hits. &quot;</span>
                    <span class="s2">&quot;Inspect HMMER output tables to evaluate hits.&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">contig_names</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">contig</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">contig</span> <span class="ow">in</span> <span class="n">contig_names</span><span class="p">:</span>
            <span class="n">contig_hits</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="p">[</span><span class="n">all_hit_labels</span><span class="o">.</span><span class="n">contig</span> <span class="o">==</span> <span class="n">contig</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
                <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">matched_hit_labels</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">hmm_group</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">hmm_group</span> <span class="ow">in</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span><span class="p">:</span>

                <span class="n">hmm_match</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">hmm_code</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
                    <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span>
                <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">contains_hmm_pattern</span><span class="p">)</span>
                <span class="n">strand_match</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">strand</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
                    <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span>
                <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">contains_strand_pattern</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">distance_match</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">gene_pos_diff</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
                        <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">contains_distance_pattern</span><span class="p">)</span>
                    <span class="n">matched_rows</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="p">[</span>
                        <span class="p">(</span><span class="n">hmm_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">strand_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">distance_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">matched_rows</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="p">[(</span><span class="n">hmm_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">strand_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">matched_rows</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">matched_hits</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
                        <span class="n">i</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span>
                    <span class="p">]</span>
                    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">hmm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">matched_hits</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">matched_hits</span><span class="o">.</span><span class="n">hmm</span>
                    <span class="p">):</span>
                        <span class="n">matched_hit_labels</span><span class="p">[</span><span class="n">hmm</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

                <span class="n">all_matched_hits</span><span class="p">[</span><span class="n">contig</span><span class="p">]</span> <span class="o">=</span> <span class="n">matched_hit_labels</span>
        <span class="k">return</span> <span class="n">all_matched_hits</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHMMfilter.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">hmm_hits</span><span class="p">,</span> <span class="n">synteny_structure</span><span class="p">,</span> <span class="n">unordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Search for contigs that satisfy the given gene synteny structure.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>hmm_hits</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dict of pandas DataFrames, as output by
parseHMMsearchOutput with keys corresponding to hmm names</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>synteny_structure</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a str describing the desired synteny structure,
structured as follows:</p>
<p>'&gt;hmm_a N_ab hmm_b bc &lt;hmm_c'</p>
<p>where N_ab corresponds to the maximum number of genes separating
gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds
to the name of the hmm as provided in the keys of hmm_hits.
More than two hmms can be concatenated. Strand location may be
specificed by using '&gt;' for sense and '&lt;' for antisense.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>unordered</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether the HMMs should be arranged in the
exact same order displayed in the synteny_structure or in
any order. If ordered, the filters would filter collinear rather
than syntenic structures. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">hmm_hits</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">synteny_structure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for contigs that satisfy the given gene synteny structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        hmm_hits (dict): a dict of pandas DataFrames, as output by</span>
<span class="sd">            parseHMMsearchOutput with keys corresponding to hmm names</span>
<span class="sd">        synteny_structure (str): a str describing the desired synteny structure,</span>
<span class="sd">            structured as follows:</span>

<span class="sd">            &#39;&gt;hmm_a N_ab hmm_b bc &lt;hmm_c&#39;</span>

<span class="sd">            where N_ab corresponds to the maximum number of genes separating</span>
<span class="sd">            gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds</span>
<span class="sd">            to the name of the hmm as provided in the keys of hmm_hits.</span>
<span class="sd">            More than two hmms can be concatenated. Strand location may be</span>
<span class="sd">            specificed by using &#39;&gt;&#39; for sense and &#39;&lt;&#39; for antisense.</span>
<span class="sd">        unordered (bool, optional): whether the HMMs should be arranged in the</span>
<span class="sd">            exact same order displayed in the synteny_structure or in</span>
<span class="sd">            any order. If ordered, the filters would filter collinear rather</span>
<span class="sd">            than syntenic structures. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span> <span class="o">=</span> <span class="n">unordered</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hmm_hits</span> <span class="o">=</span> <span class="n">hmm_hits</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hmms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hmm_hits</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span> <span class="o">=</span> <span class="n">synteny_structure</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_contains_hmm_groups</span> <span class="o">=</span> <span class="n">syntenyparser</span><span class="o">.</span><span class="n">contains_HMM_groups</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span> <span class="o">=</span> <span class="n">syntenyparser</span><span class="o">.</span><span class="n">parse_synteny_structure</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;strands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;strands&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Disregarding strand location as unordered structured selected&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hmm_order_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;hmm_groups&quot;</span><span class="p">],</span>
            <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parsed_structure</span><span class="p">[</span><span class="s2">&quot;hmm_groups&quot;</span><span class="p">])),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hmm_order_dict</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span> <span class="o">=</span> <span class="n">unordered</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHMMfilter.filter_hits_by_synteny_structure" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_hits_by_synteny_structure</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Search for contigs that satisfy the given gene synteny structure.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>HMMER3 hits separated by contig.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_hits_by_synteny_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for contigs that satisfy the given gene synteny structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: HMMER3 hits separated by contig.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_matched_hits</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">SyntenyPatternFilters</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_structure</span><span class="p">,</span> <span class="n">unordered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span>
    <span class="p">)</span>
    <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_HMM_hits</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;At least two different HMMs produced identical sequence hits&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;All input profile HMMs rendered identical sequence hits. &quot;</span>
                <span class="s2">&quot;Inspect HMMER output tables to evaluate hits.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">contig_names</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">contig</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">contig</span> <span class="ow">in</span> <span class="n">contig_names</span><span class="p">:</span>
        <span class="n">contig_hits</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="p">[</span><span class="n">all_hit_labels</span><span class="o">.</span><span class="n">contig</span> <span class="o">==</span> <span class="n">contig</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
            <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">matched_hit_labels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">hmm_group</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">hmm_group</span> <span class="ow">in</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span><span class="p">:</span>

            <span class="n">hmm_match</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">hmm_code</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
                <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span>
            <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">contains_hmm_pattern</span><span class="p">)</span>
            <span class="n">strand_match</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">strand</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
                <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span>
            <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">contains_strand_pattern</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">distance_match</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">gene_pos_diff</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
                    <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span>
                <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">contains_distance_pattern</span><span class="p">)</span>
                <span class="n">matched_rows</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">hmm_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">strand_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">distance_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">matched_rows</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="p">[(</span><span class="n">hmm_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">strand_match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">matched_rows</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">matched_hits</span> <span class="o">=</span> <span class="n">contig_hits</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
                    <span class="n">i</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">hmm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">matched_hits</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">matched_hits</span><span class="o">.</span><span class="n">hmm</span>
                <span class="p">):</span>
                    <span class="n">matched_hit_labels</span><span class="p">[</span><span class="n">hmm</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

            <span class="n">all_matched_hits</span><span class="p">[</span><span class="n">contig</span><span class="p">]</span> <span class="o">=</span> <span class="n">matched_hit_labels</span>
    <span class="k">return</span> <span class="n">all_matched_hits</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHMMfilter.get_all_HMM_hits" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_all_HMM_hits</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Group and preprocess all hit labels into a single dataframe.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>pd.DataFrame: HMMER3 hit labels matching provided HMMs.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_HMM_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Group and preprocess all hit labels into a single dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: HMMER3 hit labels matching provided HMMs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hit_labels</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">hmm</span><span class="p">,</span> <span class="n">hits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hmm_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">hits</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No records found in database matching HMM: </span><span class="si">{</span><span class="n">hmm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hit_labels</span><span class="p">[</span><span class="n">hmm</span><span class="p">]</span> <span class="o">=</span> <span class="n">labelparser</span><span class="o">.</span><span class="n">parse_from_list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">hit_labels</span><span class="p">[</span><span class="n">hmm</span><span class="p">][</span><span class="s2">&quot;hmm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmm</span>
    <span class="c1"># Create single dataframe with new column corresponding to HMM and all hits</span>
    <span class="c1"># Remove contigs with less hits than the number of hmms in synteny structure (drop if enabling partial searching)</span>
    <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">hit_labels</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;contig&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_hmm_groups</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;contig&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_pos&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains_hmm_groups</span><span class="p">:</span>
        <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_hits_by_HMM_group</span><span class="p">(</span><span class="n">all_hit_labels</span><span class="p">)</span>
    <span class="n">all_hit_labels</span> <span class="o">=</span> <span class="n">all_hit_labels</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_meta_codes_to_HMM_hits</span><span class="p">(</span><span class="n">all_hit_labels</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pynteny.filter.SyntenyHits" class="doc doc-heading">
        <code>SyntenyHits</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Store and manipulate synteny hits by contig</p>


        <details class="quote">
          <summary>Source code in <code>pynteny/filter.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SyntenyHits</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store and manipulate synteny hits by contig&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synteny_hits</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize from synteny hits object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span> <span class="o">=</span> <span class="n">synteny_hits</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_hits_to_dataframe</span><span class="p">(</span><span class="n">hits_by_contig</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return synteny hits as a dataframe&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;contig&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gene_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gene_number&quot;</span><span class="p">,</span>
            <span class="s2">&quot;locus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;strand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;full_label&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hmm&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">contig</span><span class="p">,</span> <span class="n">matched_hits</span> <span class="ow">in</span> <span class="n">hits_by_contig</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">hmm</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">matched_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="n">parsed_label</span> <span class="o">=</span> <span class="n">labelparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">parsed_label</span><span class="p">[</span><span class="s2">&quot;contig&quot;</span><span class="p">],</span>
                            <span class="n">parsed_label</span><span class="p">[</span><span class="s2">&quot;gene_id&quot;</span><span class="p">],</span>
                            <span class="n">parsed_label</span><span class="p">[</span><span class="s2">&quot;gene_pos&quot;</span><span class="p">],</span>
                            <span class="n">parsed_label</span><span class="p">[</span><span class="s2">&quot;locus_pos&quot;</span><span class="p">],</span>
                            <span class="n">parsed_label</span><span class="p">[</span><span class="s2">&quot;strand&quot;</span><span class="p">],</span>
                            <span class="n">parsed_label</span><span class="p">[</span><span class="s2">&quot;full_label&quot;</span><span class="p">],</span>
                            <span class="n">hmm</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;contig&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_number&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hits_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hits_by_contig</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SyntenyHits</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize SyntenyHits object from hits_by_contig dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            hits_by_contig (dict): HMMER3 hit labels separated by contig name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SyntenyHits: initialized object of class SyntenyHits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_hits_to_dataframe</span><span class="p">(</span><span class="n">hits_by_contig</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return synteny hits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Synteny hits as dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span>

    <span class="k">def</span> <span class="nf">add_HMM_meta_info_to_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hmm_meta</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SyntenyHits</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add molecular metadata to synteny hits.</span>

<span class="sd">        Args:</span>
<span class="sd">            hmm_meta (Path): path to PGAP metadata file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SyntenyHits: and instance of class SyntenyHits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gene_symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;ec_number&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span>
        <span class="n">pgap</span> <span class="o">=</span> <span class="n">PGAP</span><span class="p">(</span><span class="n">hmm_meta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span><span class="n">fields</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># for i, row in self._synteny_hits.iterrows():</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Index&quot;</span><span class="p">)</span>
            <span class="n">hmm_group</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;hmm&quot;</span><span class="p">)</span>
            <span class="n">meta_values</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pgap</span><span class="o">.</span><span class="n">get_meta_info_for_HMM</span><span class="p">(</span><span class="n">hmm</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;#ncbi_accession&quot;</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">hmm</span> <span class="ow">in</span> <span class="n">hmm_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>  <span class="c1"># row.hmm.split(&quot;|&quot;)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">fields</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">meta_values</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">SyntenyHits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_to_TSV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_tsv</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write synteny hits to a TSV file.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_tsv (Path): path to output tsv file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_hit_sequences_to_FASTA_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sequence_database</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write matching sequences to FASTA files.</span>

<span class="sd">        Args:</span>
<span class="sd">            sequence_database (Path): path to the peptide or nucleotide sequence database</span>
<span class="sd">                in which the synteny search was conducted.</span>
<span class="sd">            output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">            output_prefix (str, optional): prefix for output files. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fasta</span> <span class="o">=</span> <span class="n">FASTA</span><span class="p">(</span><span class="n">sequence_database</span><span class="p">)</span>
        <span class="n">hmm_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">hmm_group</span> <span class="ow">in</span> <span class="n">hmm_groups</span><span class="p">:</span>
            <span class="n">record_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">==</span> <span class="n">hmm_group</span>
            <span class="p">]</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;gene_symbol&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">columns</span>
                <span class="ow">and</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">):</span>
                <span class="n">gene_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">==</span> <span class="n">hmm_group</span>
                <span class="p">]</span><span class="o">.</span><span class="n">gene_symbol</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">gene_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">==</span> <span class="n">hmm_group</span>
                <span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">gene_id</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">gene_symbol</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">gene_symbol</span><span class="p">)</span>
                    <span class="k">else</span> <span class="p">(</span><span class="n">gene_label</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">gene_label</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gene_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">gene_id_str</span> <span class="o">=</span> <span class="n">gene_id</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="k">if</span> <span class="n">gene_id</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

            <span class="n">output_fasta</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">output_dir</span>
                <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}{</span><span class="n">gene_id_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">hmm_group</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_hits.fasta&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">record_ids</span><span class="p">:</span>
                <span class="n">fasta</span><span class="o">.</span><span class="n">filter_by_IDs</span><span class="p">(</span>
                    <span class="n">record_ids</span><span class="o">=</span><span class="n">record_ids</span><span class="p">,</span>
                    <span class="n">output_file</span><span class="o">=</span><span class="n">output_fasta</span><span class="p">,</span>
                    <span class="n">point_to_new_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No record matches found in synteny structure for HMM: </span><span class="si">{</span><span class="n">hmm_group</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pynteny.filter.SyntenyHits.hits" class="doc doc-heading">
<code class="highlight language-python"><span class="n">hits</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return synteny hits.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>pd.DataFrame: Synteny hits as dataframe.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>



<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHits.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">synteny_hits</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize from synteny hits object.</p>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synteny_hits</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize from synteny hits object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span> <span class="o">=</span> <span class="n">synteny_hits</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHits.add_HMM_meta_info_to_hits" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_HMM_meta_info_to_hits</span><span class="p">(</span><span class="n">hmm_meta</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add molecular metadata to synteny hits.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>hmm_meta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to PGAP metadata file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>SyntenyHits</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pynteny.filter.SyntenyHits" href="api/#pynteny.filter.SyntenyHits">SyntenyHits</a></code>
          </td>
          <td><p>and instance of class SyntenyHits.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_HMM_meta_info_to_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hmm_meta</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SyntenyHits</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add molecular metadata to synteny hits.</span>

<span class="sd">    Args:</span>
<span class="sd">        hmm_meta (Path): path to PGAP metadata file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SyntenyHits: and instance of class SyntenyHits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gene_symbol&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;ec_number&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span>
    <span class="n">pgap</span> <span class="o">=</span> <span class="n">PGAP</span><span class="p">(</span><span class="n">hmm_meta</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span><span class="n">fields</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># for i, row in self._synteny_hits.iterrows():</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Index&quot;</span><span class="p">)</span>
        <span class="n">hmm_group</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;hmm&quot;</span><span class="p">)</span>
        <span class="n">meta_values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pgap</span><span class="o">.</span><span class="n">get_meta_info_for_HMM</span><span class="p">(</span><span class="n">hmm</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;#ncbi_accession&quot;</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">hmm</span> <span class="ow">in</span> <span class="n">hmm_group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>  <span class="c1"># row.hmm.split(&quot;|&quot;)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">fields</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">meta_values</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">SyntenyHits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHits.from_hits_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_hits_dict</span><span class="p">(</span><span class="n">hits_by_contig</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize SyntenyHits object from hits_by_contig dictionary.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>hits_by_contig</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>HMMER3 hit labels separated by contig name.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>SyntenyHits</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pynteny.filter.SyntenyHits" href="api/#pynteny.filter.SyntenyHits">SyntenyHits</a></code>
          </td>
          <td><p>initialized object of class SyntenyHits.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_hits_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hits_by_contig</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SyntenyHits</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize SyntenyHits object from hits_by_contig dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        hits_by_contig (dict): HMMER3 hit labels separated by contig name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SyntenyHits: initialized object of class SyntenyHits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_hits_to_dataframe</span><span class="p">(</span><span class="n">hits_by_contig</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHits.write_hit_sequences_to_FASTA_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write_hit_sequences_to_FASTA_files</span><span class="p">(</span><span class="n">sequence_database</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Write matching sequences to FASTA files.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sequence_database</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to the peptide or nucleotide sequence database
in which the synteny search was conducted.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix for output files. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_hit_sequences_to_FASTA_files</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sequence_database</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write matching sequences to FASTA files.</span>

<span class="sd">    Args:</span>
<span class="sd">        sequence_database (Path): path to the peptide or nucleotide sequence database</span>
<span class="sd">            in which the synteny search was conducted.</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        output_prefix (str, optional): prefix for output files. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fasta</span> <span class="o">=</span> <span class="n">FASTA</span><span class="p">(</span><span class="n">sequence_database</span><span class="p">)</span>
    <span class="n">hmm_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">hmm_group</span> <span class="ow">in</span> <span class="n">hmm_groups</span><span class="p">:</span>
        <span class="n">record_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">==</span> <span class="n">hmm_group</span>
        <span class="p">]</span><span class="o">.</span><span class="n">full_label</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;gene_symbol&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">columns</span>
            <span class="ow">and</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">):</span>
            <span class="n">gene_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">==</span> <span class="n">hmm_group</span>
            <span class="p">]</span><span class="o">.</span><span class="n">gene_symbol</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">gene_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">hmm</span> <span class="o">==</span> <span class="n">hmm_group</span>
            <span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">gene_id</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">gene_symbol</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">gene_symbol</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">(</span><span class="n">gene_label</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">gene_label</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gene_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">gene_id_str</span> <span class="o">=</span> <span class="n">gene_id</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="k">if</span> <span class="n">gene_id</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="n">output_fasta</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">output_dir</span>
            <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}{</span><span class="n">gene_id_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}{</span><span class="n">hmm_group</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_hits.fasta&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">record_ids</span><span class="p">:</span>
            <span class="n">fasta</span><span class="o">.</span><span class="n">filter_by_IDs</span><span class="p">(</span>
                <span class="n">record_ids</span><span class="o">=</span><span class="n">record_ids</span><span class="p">,</span>
                <span class="n">output_file</span><span class="o">=</span><span class="n">output_fasta</span><span class="p">,</span>
                <span class="n">point_to_new_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No record matches found in synteny structure for HMM: </span><span class="si">{</span><span class="n">hmm_group</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyHits.write_to_TSV" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write_to_TSV</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Write synteny hits to a TSV file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>output_tsv</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output tsv file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_to_TSV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_tsv</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write synteny hits to a TSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_tsv (Path): path to output tsv file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_synteny_hits</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pynteny.filter.SyntenyPatternFilters" class="doc doc-heading">
        <code>SyntenyPatternFilters</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Methods to filter hmm hits in the  same contig by synteny structure
or collinearity. These filters are inputs to pandas.Dataframe.rolling method.</p>


        <details class="quote">
          <summary>Source code in <code>pynteny/filter.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SyntenyPatternFilters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Methods to filter hmm hits in the  same contig by synteny structure</span>
<span class="sd">    or collinearity. These filters are inputs to pandas.Dataframe.rolling method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synteny_structure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize filter class from synteny structure.</span>

<span class="sd">        Args:</span>
<span class="sd">            synteny_structure (str): a str describing the desired synteny structure,</span>
<span class="sd">                structured as follows:</span>

<span class="sd">                &#39;&gt;hmm_a N_ab hmm_b bc &lt;hmm_c&#39;</span>

<span class="sd">                where N_ab corresponds to the maximum number of genes separating</span>
<span class="sd">                gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds</span>
<span class="sd">                to the name of the hmm as provided in the keys of hmm_hits.</span>
<span class="sd">                More than two hmms can be concatenated. Strand location may be</span>
<span class="sd">                specified by using &#39;&gt;&#39; for sense and &#39;&lt;&#39; for antisense.</span>
<span class="sd">            unordered (bool, optional): whether the HMMs should be arranged in the</span>
<span class="sd">                exact same order displayed in the synteny_structure or in</span>
<span class="sd">                any order. If ordered, the filters would filter collinear rather</span>
<span class="sd">                than syntenic structures. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_structure</span> <span class="o">=</span> <span class="n">syntenyparser</span><span class="o">.</span><span class="n">parse_synteny_structure</span><span class="p">(</span><span class="n">synteny_structure</span><span class="p">)</span>
        <span class="n">hmm_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;hmm_groups&quot;</span><span class="p">])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmm_code_order_pattern</span> <span class="o">=</span> <span class="n">hmm_codes</span>

        <span class="k">if</span> <span class="n">unordered</span><span class="p">:</span>
            <span class="n">max_distance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">])</span>
            <span class="n">max_distances</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="n">max_distance</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_distances</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">]</span>
        <span class="n">min_distances</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_order_pattern</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">min_distances</span><span class="p">,</span> <span class="n">max_distances</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">strand_order_pattern</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">strand</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="s2">&quot;neg&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="s2">&quot;pos&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;strands&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span> <span class="o">=</span> <span class="n">unordered</span>

    <span class="k">def</span> <span class="nf">contains_hmm_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if series items contain a profile HMM</span>

<span class="sd">        Args:</span>
<span class="sd">            data (pd.Series): a series resulting from calling rolling on a pandas column.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: 1 for True 0 for False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hmm_code_order_pattern</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hmm_code_order_pattern</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">contains_distance_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if series items satisfy the maximum distance</span>
<span class="sd">           between HMM hits.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (pd.Series): a series resulting from calling rolling on a pandas column.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: 1 for True 0 for False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="n">data_dist</span> <span class="o">&lt;=</span> <span class="n">max_dist</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data_dist</span> <span class="o">&gt;</span> <span class="n">min_dist</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">data_dist</span><span class="p">,</span> <span class="p">(</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_order_pattern</span>
                    <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">contains_strand_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if series items satisfy the strand pattern</span>
<span class="sd">           between HMM hits.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (pd.Series): a series resulting from calling rolling on a pandas column.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: 1 for True 0 for False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strand_comparisons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data_strand</span><span class="p">,</span> <span class="n">pattern_strand</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strand_order_pattern</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pattern_strand</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">strand_comparisons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_strand</span> <span class="o">==</span> <span class="n">pattern_strand</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">strand_comparisons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">strand_comparisons</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyPatternFilters.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">synteny_structure</span><span class="p">,</span> <span class="n">unordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize filter class from synteny structure.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>synteny_structure</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a str describing the desired synteny structure,
structured as follows:</p>
<p>'&gt;hmm_a N_ab hmm_b bc &lt;hmm_c'</p>
<p>where N_ab corresponds to the maximum number of genes separating
gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds
to the name of the hmm as provided in the keys of hmm_hits.
More than two hmms can be concatenated. Strand location may be
specified by using '&gt;' for sense and '&lt;' for antisense.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>unordered</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether the HMMs should be arranged in the
exact same order displayed in the synteny_structure or in
any order. If ordered, the filters would filter collinear rather
than syntenic structures. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synteny_structure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize filter class from synteny structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        synteny_structure (str): a str describing the desired synteny structure,</span>
<span class="sd">            structured as follows:</span>

<span class="sd">            &#39;&gt;hmm_a N_ab hmm_b bc &lt;hmm_c&#39;</span>

<span class="sd">            where N_ab corresponds to the maximum number of genes separating</span>
<span class="sd">            gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds</span>
<span class="sd">            to the name of the hmm as provided in the keys of hmm_hits.</span>
<span class="sd">            More than two hmms can be concatenated. Strand location may be</span>
<span class="sd">            specified by using &#39;&gt;&#39; for sense and &#39;&lt;&#39; for antisense.</span>
<span class="sd">        unordered (bool, optional): whether the HMMs should be arranged in the</span>
<span class="sd">            exact same order displayed in the synteny_structure or in</span>
<span class="sd">            any order. If ordered, the filters would filter collinear rather</span>
<span class="sd">            than syntenic structures. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parsed_structure</span> <span class="o">=</span> <span class="n">syntenyparser</span><span class="o">.</span><span class="n">parse_synteny_structure</span><span class="p">(</span><span class="n">synteny_structure</span><span class="p">)</span>
    <span class="n">hmm_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;hmm_groups&quot;</span><span class="p">])))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hmm_code_order_pattern</span> <span class="o">=</span> <span class="n">hmm_codes</span>

    <span class="k">if</span> <span class="n">unordered</span><span class="p">:</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">])</span>
        <span class="n">max_distances</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">max_distance</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">]</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_distances</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">]</span>
    <span class="n">min_distances</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;distances&quot;</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distance_order_pattern</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">min_distances</span><span class="p">,</span> <span class="n">max_distances</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">strand_order_pattern</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">strand</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="s2">&quot;neg&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="s2">&quot;pos&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">parsed_structure</span><span class="p">[</span><span class="s2">&quot;strands&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span> <span class="o">=</span> <span class="n">unordered</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyPatternFilters.contains_distance_pattern" class="doc doc-heading">
<code class="highlight language-python"><span class="n">contains_distance_pattern</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check if series items satisfy the maximum distance
   between HMM hits.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code>
          </td>
          <td><p>a series resulting from calling rolling on a pandas column.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>1 for True 0 for False.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contains_distance_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if series items satisfy the maximum distance</span>
<span class="sd">       between HMM hits.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.Series): a series resulting from calling rolling on a pandas column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: 1 for True 0 for False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">data_dist</span> <span class="o">&lt;=</span> <span class="n">max_dist</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data_dist</span> <span class="o">&gt;</span> <span class="n">min_dist</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">data_dist</span><span class="p">,</span> <span class="p">(</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_order_pattern</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">else</span> <span class="mi">0</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyPatternFilters.contains_hmm_pattern" class="doc doc-heading">
<code class="highlight language-python"><span class="n">contains_hmm_pattern</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check if series items contain a profile HMM</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code>
          </td>
          <td><p>a series resulting from calling rolling on a pandas column.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>1 for True 0 for False.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contains_hmm_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if series items contain a profile HMM</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.Series): a series resulting from calling rolling on a pandas column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: 1 for True 0 for False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unordered</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hmm_code_order_pattern</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">hmm_code_order_pattern</span> <span class="k">else</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="pynteny.filter.SyntenyPatternFilters.contains_strand_pattern" class="doc doc-heading">
<code class="highlight language-python"><span class="n">contains_strand_pattern</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check if series items satisfy the strand pattern
   between HMM hits.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code>
          </td>
          <td><p>a series resulting from calling rolling on a pandas column.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>1 for True 0 for False.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contains_strand_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if series items satisfy the strand pattern</span>
<span class="sd">       between HMM hits.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.Series): a series resulting from calling rolling on a pandas column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: 1 for True 0 for False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strand_comparisons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data_strand</span><span class="p">,</span> <span class="n">pattern_strand</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strand_order_pattern</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pattern_strand</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">strand_comparisons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_strand</span> <span class="o">==</span> <span class="n">pattern_strand</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strand_comparisons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">strand_comparisons</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="pynteny.filter.filter_FASTA_by_synteny_structure" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_FASTA_by_synteny_structure</span><span class="p">(</span><span class="n">synteny_structure</span><span class="p">,</span> <span class="n">input_fasta</span><span class="p">,</span> <span class="n">input_hmms</span><span class="p">,</span> <span class="n">unordered</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hmm_meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hmmer_output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reuse_hmmer_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hmmsearch&#39;</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generate protein-specific database by filtering sequence database
   to only contain sequences which satisfy the provided (gene/hmm) structure.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>synteny_structure</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a str describing the desired synteny structure,
structured as follows:</p>
<p>'&gt;hmm_a N_ab hmm_b bc &lt;hmm_c'</p>
<p>where N_ab corresponds to the maximum number of genes separating
gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds
to the name of the hmm as provided in the keys of hmm_hits.
More than two hmms can be concatenated. Strand location may be
specificed by using '&gt;' for sense and '&lt;' for antisense.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>input fasta containing sequence database to be searched.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_hmms</code></td>
          <td>
                <code>list[<span title="pathlib.Path">Path</span>]</code>
          </td>
          <td><p>list containing paths to hmms contained in synteny structure.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>unordered</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether HMM hits should follow the exact order
displayed in the synteny structure string or not, i.e., whether
to search for only synteny (colocation) or collinearity as well
(same order). Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>hmm_meta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to PGAP's metadata file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>hmmer_output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>output directory to store HMMER3 output files. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reuse_hmmer_results</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True then HMMER3 won't be run again for HMMs already
searched in the same output directory. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>select between 'hmmsearch' or 'hmmscan'. Defaults to 'hmmsearch'.</p></td>
          <td>
                <code>&#39;hmmsearch&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>processes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of threads to be employed. Defaults to all minus one.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>additional arguments to hmmsearch or hmmscan. Each
element in the list is a string with additional arguments for each
input hmm (arranged in the same order), an element can also take a
value of None to avoid passing additional arguments for a specific
input hmm. A single string may also be passed, in which case the
same additional argument is passed to hmmsearch for all input hmms. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>SyntenyHits</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="pynteny.filter.SyntenyHits" href="api/#pynteny.filter.SyntenyHits">SyntenyHits</a></code>
          </td>
          <td><p>object of class SyntenyHits containing labels matching synteny structure.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>pynteny/filter.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_FASTA_by_synteny_structure</span><span class="p">(</span>
    <span class="n">synteny_structure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">input_hmms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">unordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hmm_meta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hmmer_output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reuse_hmmer_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hmmsearch&quot;</span><span class="p">,</span>
    <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SyntenyHits</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate protein-specific database by filtering sequence database</span>
<span class="sd">       to only contain sequences which satisfy the provided (gene/hmm) structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        synteny_structure (str): a str describing the desired synteny structure,</span>
<span class="sd">            structured as follows:</span>

<span class="sd">            &#39;&gt;hmm_a N_ab hmm_b bc &lt;hmm_c&#39;</span>

<span class="sd">            where N_ab corresponds to the maximum number of genes separating</span>
<span class="sd">            gene found by hmm_a and gene found by hmm_b, and hmm_ corresponds</span>
<span class="sd">            to the name of the hmm as provided in the keys of hmm_hits.</span>
<span class="sd">            More than two hmms can be concatenated. Strand location may be</span>
<span class="sd">            specificed by using &#39;&gt;&#39; for sense and &#39;&lt;&#39; for antisense.</span>
<span class="sd">        input_fasta (Path): input fasta containing sequence database to be searched.</span>
<span class="sd">        input_hmms (list[Path]): list containing paths to hmms contained in synteny structure.</span>
<span class="sd">        unordered (bool, optional): whether HMM hits should follow the exact order</span>
<span class="sd">            displayed in the synteny structure string or not, i.e., whether</span>
<span class="sd">            to search for only synteny (colocation) or collinearity as well</span>
<span class="sd">            (same order). Defaults to False.</span>
<span class="sd">        hmm_meta (Path, optional): path to PGAP&#39;s metadata file. Defaults to None.</span>
<span class="sd">        hmmer_output_dir (Path, optional): output directory to store HMMER3 output files. Defaults to None.</span>
<span class="sd">        reuse_hmmer_results (bool, optional): if True then HMMER3 won&#39;t be run again for HMMs already</span>
<span class="sd">            searched in the same output directory. Defaults to True.</span>
<span class="sd">        method (str, optional): select between &#39;hmmsearch&#39; or &#39;hmmscan&#39;. Defaults to &#39;hmmsearch&#39;.</span>
<span class="sd">        processes (int, optional): maximum number of threads to be employed. Defaults to all minus one.</span>
<span class="sd">        additional_args (list[str], optional): additional arguments to hmmsearch or hmmscan. Each</span>
<span class="sd">            element in the list is a string with additional arguments for each</span>
<span class="sd">            input hmm (arranged in the same order), an element can also take a</span>
<span class="sd">            value of None to avoid passing additional arguments for a specific</span>
<span class="sd">            input hmm. A single string may also be passed, in which case the</span>
<span class="sd">            same additional argument is passed to hmmsearch for all input hmms. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SyntenyHits: object of class SyntenyHits containing labels matching synteny structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">hmmer_output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hmmer_output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;hmmer_outputs&quot;</span>

    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">input_hmms</span><span class="p">]</span>

    <span class="c1"># if type(additional_args) == str:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">additional_args</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Repeating hmmsearch arg: &#39;</span><span class="si">{</span><span class="n">additional_args</span><span class="si">}</span><span class="s2">&#39; for all HMMs&quot;</span><span class="p">)</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">additional_args</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">input_hmms</span><span class="p">]</span>

    <span class="c1"># elif type(additional_args) == list:</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">additional_args</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">additional_args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Repeating hmmsearch arg: &#39;</span><span class="si">{</span><span class="n">additional_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; for all HMMs&quot;</span>
            <span class="p">)</span>
            <span class="n">additional_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">additional_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">input_hmms</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">additional_args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">additional_args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_hmms</span><span class="p">)):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Provided additional argument strings are less than the number of input hmms.&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Additional arguments must be: 1) a list[str], 2) a str, or 3) None&quot;</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">hmmer_output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">hmmer_output_dir</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running Hmmer&quot;</span><span class="p">)</span>
    <span class="n">hmmer</span> <span class="o">=</span> <span class="n">HMMER</span><span class="p">(</span>
        <span class="n">input_hmms</span><span class="o">=</span><span class="n">input_hmms</span><span class="p">,</span>
        <span class="n">input_data</span><span class="o">=</span><span class="n">input_fasta</span><span class="p">,</span>
        <span class="n">hmm_output_dir</span><span class="o">=</span><span class="n">hmmer_output_dir</span><span class="p">,</span>
        <span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span>
        <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_args</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">hmm_hits</span> <span class="o">=</span> <span class="n">hmmer</span><span class="o">.</span><span class="n">get_HMMER_tables</span><span class="p">(</span>
        <span class="n">reuse_hmmer_results</span><span class="o">=</span><span class="n">reuse_hmmer_results</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
    <span class="p">)</span>
    <span class="n">hmms_without_hits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hmm_name</span><span class="p">,</span> <span class="n">hmmer_hits</span> <span class="ow">in</span> <span class="n">hmm_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">hmmer_hits</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">hmms_without_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hmm_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hmms_without_hits</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">hmm_name</span> <span class="ow">in</span> <span class="n">hmms_without_hits</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No records found in database matching HMM: </span><span class="si">{</span><span class="n">hmm_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Filtering results by synteny structure&quot;</span><span class="p">)</span>
    <span class="n">syntenyfilter</span> <span class="o">=</span> <span class="n">SyntenyHMMfilter</span><span class="p">(</span><span class="n">hmm_hits</span><span class="p">,</span> <span class="n">synteny_structure</span><span class="p">,</span> <span class="n">unordered</span><span class="o">=</span><span class="n">unordered</span><span class="p">)</span>
    <span class="n">hits_by_contig</span> <span class="o">=</span> <span class="n">syntenyfilter</span><span class="o">.</span><span class="n">filter_hits_by_synteny_structure</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">hmm_meta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SyntenyHits</span><span class="o">.</span><span class="n">from_hits_dict</span><span class="p">(</span><span class="n">hits_by_contig</span><span class="p">)</span><span class="o">.</span><span class="n">add_HMM_meta_info_to_hits</span><span class="p">(</span>
            <span class="n">hmm_meta</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SyntenyHits</span><span class="o">.</span><span class="n">from_hits_dict</span><span class="p">(</span><span class="n">hits_by_contig</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Robaina/Pynteny" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../javascripts/mathjax.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
